import openpyxl
import logging
import pyautogui
from openpyxl import load_workbook
from openpyxl.utils import get_column_letter

# Configure logging
logging.basicConfig(filename='automation_log.log', level=logging.INFO, format='%(asctime)s - %(levelname)s: %(message)s')

# Step 1: Open xlsm file
file_path = "your_file.xlsm"
workbook = load_workbook(filename=file_path, read_only=False, keep_vba=True)

# Log opening file
logging.info(f"Opened file: {file_path}")

# Step 2: On Main worksheet, click on Reconnect DB Button
main_sheet = workbook["Main"]

# Assuming Reconnect DB Button is at row 8, column 9
reconnect_button = main_sheet.cell(row=8, column=9)

# Get the screen coordinates of the cell
cell_position = pyautogui.position(x=reconnect_button.coordinate.x, y=reconnect_button.coordinate.y)

# Log clicking on Reconnect DB Button
logging.info("Clicking on Reconnect DB Button")
pyautogui.click(cell_position[0], cell_position[1])

# Step 3: Go to line 16, column E, select ACBS from dropdown
line_number = 16
column_letter = 'E'
cell_address = f"{get_column_letter(main_sheet[column_letter + str(line_number)].column)}{line_number}"

main_sheet[cell_address] = "ACBS"  # Set the value directly

# Log updating value in cell
logging.info(f"Updated value at {cell_address} to ACBS")

# Step 4: Click on Enter TrialBal Adj button
# Assuming Enter TrialBal Adj button is at row 8, column 10
enter_button = main_sheet.cell(row=8, column=10)

# Get the screen coordinates of the cell
cell_position = pyautogui.position(x=enter_button.coordinate.x, y=enter_button.coordinate.y)

# Log clicking on Enter TrialBal Adj button
logging.info("Clicking on Enter TrialBal Adj button")
pyautogui.click(cell_position[0], cell_position[1])

# Save the changes
workbook.save("updated_file.xlsm")

# Log saving changes
logging.info("Saved changes to the file")

# Take a screenshot
screenshot_path = "screenshot.png"
pyautogui.screenshot(screenshot_path)

# Log taking a screenshot
logging.info(f"Took a screenshot and saved it at: {screenshot_path}")







â‰ˆ============
import pyautogui
import time

# Wait for the user to position the mouse
print("Move the mouse over the element in Excel, then press Enter.")
input()

# Get the current mouse coordinates
x, y = pyautogui.position()
print(f"Mouse coordinates: x={x}, y={y}")
