import tabula
import pandas as pd
from tabula.errors import PageError

def pdf_to_csv(pdf_path, output_path):
    # Initialize an empty list to store DataFrames of filtered tables
    filtered_tables = []

    # Get the number of pages in the PDF
    with open(pdf_path, 'rb') as file:
        try:
            num_pages = len(tabula.read_pdf(file, pages='all', silent=True))
        except PageError:
            num_pages = 0

    # Extract tables from each page individually
    for page in range(1, num_pages + 1):
        print(f"Extracting tables from page {page}...")
        try:
            tables = tabula.read_pdf(pdf_path, pages=page, multiple_tables=True)
            
            # Filter tables that contain the required columns
            for table in tables:
                if all(col in table.columns for col in ["From", "To", "Field", "Length", "Picture"]):
                    # Append the filtered table to the list
                    filtered_tables.append(table)
        except PageError:
            print(f"Page {page} does not exist. Skipping...")

    # Concatenate all filtered tables into one DataFrame
    if filtered_tables:
        all_tables = pd.concat(filtered_tables, ignore_index=True)
        
        # Write the concatenated DataFrame to a single CSV file
        all_tables.to_csv(output_path, index=False)
        print("CSV file generated successfully!")
    else:
        print("No tables found with the required columns. CSV file not generated.")

# Example usage:
pdf_path = "input.pdf"
output_path = "output_table.csv"
pdf_to_csv(pdf_path, output_path)
